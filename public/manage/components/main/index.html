<style>
    .layui-card-pointer {cursor: pointer;}
</style>
<div class="layui-fluid">

    <!--卡片-->
    <div class="layui-row layui-col-space15" id="statistics_box">
        <div class="layui-col-xs12 layui-col-sm4 layui-col-md2">
            <div class="layui-card layui-card-pointer" id="card1">
                <div class="layui-card-header">
                    <h2>待发货</h2>
                    <span class="layui-badge layui-bg-green pull-right">待处理</span>
                </div>
                <div class="layui-card-body" >
                    <p class="lay-big-font" id="reg_total">-</p>
                    <div class="text" style="color:#D0D0D0">订单数量</div>
                </div>

            </div>
        </div>


        <div class="layui-col-xs12 layui-col-sm4 layui-col-md2">
            <div class="layui-card layui-card-pointer" id="card2">
                <div class="layui-card-header">
                    <h2> 待退款</h2>
                    <span class="layui-badge layui-bg-red pull-right">待处理</span>
                </div>
                <div class="layui-card-body">
                    <p class="lay-big-font" id="yesterday_total">-</p>
                    <div class="text" style="color:#D0D0D0">订单数量</div>
                </div>
            </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm4 layui-col-md2">
            <div class="layui-card layui-card-pointer" id="card3">
                <div class="layui-card-header">
                    <h2>  订单总数</h2>
                    <span class="layui-badge layui-bg-green pull-right">今日</span>
                </div>
                <div class="layui-card-body">
                    <p class="lay-big-font" id="today_total">-</p>
                    <div class="text" style="color:#d0d0d0">总数</div>
                </div>
            </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md3">
            <div class="layui-card layui-card-pointer" id="card4">
                <div class="layui-card-header">
                    <h2>直播观看人数</h2>
                    <span class="layui-badge layui-bg-blue pull-right">今日</span>
                </div>
                <div class="layui-card-body">
                    <p class="lay-big-font" id="day_access_total">-</p>
                    <div class="text" style="color:#D0D0D0">人数</div>
                </div>
            </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md3">
            <div class="layui-card layui-card-pointer" id="card5">
                <div class="layui-card-header">
                    <h2>交易额</h2>
                    <span class="layui-badge layui-bg-green pull-right">今日</span>
                </div>
                <div class="layui-card-body">
                    <p class="lay-big-font" id="access_total">-</p>
                    <div class="text" style="color:#D0D0D0">总金额</div>
                </div>
            </div>
        </div>
    </div>

    <!--订单数据可视化图表-->
    <div class="layui-row">
        <div class="layui-col-lg8 layui-col-md7">
            <div class="layui-card">
                <div class="layui-card-header"><i class="layui-icon layui-icon-chart" style="font-size: 20px; color: #1E9FFF;"></i>&nbsp;订单统计</div>
                <div class="layui-card-body">
                    <div id="main" style="height: 450px;"></div>
                </div>
            </div>
        </div>

        <div class="layui-col-lg4 layui-col-md5">
            <div class="layui-card">
                <div class="layui-card-header">
                    <div class="layui-btn-group " style="float: right">
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" id="order_week">
                            周
                        </button>
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm"  id="order_month">
                            月
                        </button>
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm"  id="order_year">
                            年
                        </button>
                    </div>
                </div>
                <div class="layui-card-body" style="height: 450px;">
                    <p class="lay-big-font" id="last_sales"></p>
                    <p id="last_sales_text">上周销售额</p>

                    <p class="lay-big-font" id="recent_sales"></p>
                    <p id="recent_sales_text">本周销售额 </p>
                    <div class="layui-progress layui-progress-big" style="margin-top: 30px" lay-showpercent="true" >
                        <div style="float: right;position: relative;top: -18px;color: grey" id="tipText"></div>
                        <div class="layui-progress-bar" id="progress1" ></div>
                    </div>
                    <!--                                <div class="layui-progress layui-progress-big" lay-showrpecent="true">-->
                    <!--                                    <div class="layui-progress-bar " style="width: 40%" id="progress1"></div>-->
                    <!--                                </div>-->

                    <div><br><br></div>
                    <p class="lay-big-font" id="last_orders"></p>
                    <p id="last_orders_text">  上周订单数</p>

                    <p class="lay-big-font" id="recent_orders"></p>
                    <p id="recent_orders_text">   本周订单数</p>
                    <!--进度条2-->
                    <div class="layui-progress layui-progress-big" style="margin-top: 30px" lay-showpercent="true" >
                        <div style="float: right;position: relative;top: -18px;color: grey" id="tipText2"></div>
                        <div class="layui-progress-bar" id="progress2" ></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--用户数据图表-->
    <div class="layui-row layui-col-space15">
        <div class="layui-col-lg12 layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header"><i class="layui-icon layui-icon-chart" style="font-size: 20px; color: #1E9FFF;"></i>&nbsp;用户统计
                    <div class="layui-btn-group " style="float: right">
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" id="user_week">
                            周
                        </button>
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" id="user_month">
                            月
                        </button>
                        <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" id="user_year">
                            年
                        </button>
                    </div>
                </div>
                <!--  <div class="layui-card" style="overflow: hidden;">-->
                <!--    <div class="layui-card-header">订单统计图表</div>-->
                <div class="layui-card-body">
                    <div id="user" style="height: 450px;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-row layui-col-space15">
        <div class="layui-col-lg8 layui-col-md7">
            <div class="layui-card">
                <div class="layui-card-header">订单统计</div>
                <div class="layui-card-body">

                </div>
            </div>
        </div>

        <div class="layui-col-lg4 layui-col-md5">
            <div class="layui-card">
                <div class="layui-card-header">系统框架</div>
                <div class="layui-card-body">
                    <table class="layui-table layui-text">
                        <colgroup>
                            <col width="100">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>核心框架</td>
                            <td>ThinkPHP5.1、PHP7.2、Nginx 1.16</td>
                        </tr>
                        <tr>
                            <td>业务框架</td>
                            <td>think-queue、guzzle、think-image、php-jwt、predis</td>
                        </tr>
                        <tr>
                            <td>权限框架</td>
                            <td>oAuth2.0、Rbac</td>
                        </tr>
                        <tr>
                            <td>其他</td>
                            <td>IDEA(开发工具)、MySQL(数据库)、Redis</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="/manage/assets/libs/echarts/echarts.min.js"></script>
<!-- 改主题-->
<!-- <script src="/manage/assets/libs/echarts/infographic.js"></script>-->
<script>
    layui.use(['layer','admin','table','element'],function (){
        var layer = layui.layer,
            admin = layui.admin,
            element = layui.element,
            $ = layui.jquery;

        //卡片颜色变化(×)
        $("#card1").mouseover(function () {
            oldColor = $(this).css("background-color");
            $(this).css("background-color","#8dc1a9");
        }).mouseout(function () {
            $(this).css("background-color",oldColor);
        });
        $("#card2").mouseover(function () {
            oldColor = $(this).css("background-color");
            $(this).css("background-color","#e69d87");
        }).mouseout(function () {
            $(this).css("background-color",oldColor);
        });
        $("#card3").mouseover(function () {
            oldColor = $(this).css("background-color");
            $(this).css("background-color","#8dc1a9");
        }).mouseout(function () {
            $(this).css("background-color",oldColor);
        });
        $("#card4").mouseover(function () {
            oldColor = $(this).css("background-color");
            $(this).css("background-color","#61a0a8");
        }).mouseout(function () {
            $(this).css("background-color",oldColor);
        });
        $("#card5").mouseover(function () {
            oldColor = $(this).css("background-color");
            $(this).css("background-color","#8dc1a9");
        }).mouseout(function () {
            $(this).css("background-color",oldColor);
        });

        //请求数据
        admin.req('main/index/show', {}, function (res) {
            if(res.code == 200){
                $data = res.data;
                $("#reg_total").text($data.wait_send);
                $("#yesterday_total").text($data.wait_refund);
                $("#today_total").text($data.order_finish_total);
                $("#day_access_total").text($data.watch_people_total);
                $("#access_total").text($data.order_finish_money);

                //card对比统计数据
                $("#last_sales").text($data.ratio_date.week_ratio.last_sales);
                $("#recent_sales").text($data.ratio_date.week_ratio.recent_sales);
                $("#last_orders").text($data.ratio_date.week_ratio.last_orders);
                $("#recent_orders").text($data.ratio_date.week_ratio.recent_orders);

                //进度条初始1
                $("#tipText").text('（本周与上周同比：'+$data.ratio_date.week_ratio.sale_rate + '%');
                if ($data.ratio_date.week_ratio.sale_rate>0) {

                    $('#tipText').append("&nbsp;<span class=\"layui-edge layui-edge-top\" lay-tips=\"同比增长\" ></span>"+')');
                    //$('#tipText').css({"color": 'green'});
                    $('#progress1').css('background-color', 'green');
                    if ($data.ratio_date.week_ratio.sale_rate >= 100) {
                        // $('#tipText').css({'left': '90%'});
                        $('#progress1').css('width','100%');
                    }
                    else {
                        //$('#tipText').css({'left': $data.ratio_date.week_ratio.sale_rate+ '%'});
                        $('#progress1').css('width',$data.ratio_date.week_ratio.sale_rate + '%');
                    }
                }
                else
                {
                    $('#tipText').append("&nbsp;<span class=\"layui-edge layui-edge-bottom\" lay-tips=\"同比下降\" ></span>"+')');
                    // $('#tipText').css({"color": 'red' });
                    $('#progress1').css('background-color','indianred');
                    if(-$data.ratio_date.week_ratio.sale_rate>=100){
                        //$('#tipText').css({'left': '90%'});
                        $('#progress1').css('width','100%');
                    }
                    else{
                        //$('#tipText').css({'left': -$data.ratio_date.week_ratio.sale_rate + '%'});
                        $('#progress1').css('width',-$data.ratio_date.week_ratio.sale_rate + '%');


                    }

                }
                //进度条初始2
                $("#tipText2").text('（本周与上周同比：'+$data.ratio_date.week_ratio.order_rate + '%');
                if ($data.ratio_date.week_ratio.order_rate>0) {
                    //$('#tipText2').css({"color": 'green'});
                    $('#tipText2').append("&nbsp;<span class=\"layui-edge layui-edge-top\" lay-tips=\"同比增长\" ></span>"+')');
                    $('#progress2').css('background-color', 'green');
                    if ($data.ratio_date.week_ratio.order_rate >= 100) {
                        //$('#tipText2').css({'left': '90%'});
                        $('#progress2').css('width', '100%');
                    }
                    else {
                        //$('#tipText2').css({'left': $data.ratio_date.week_ratio.order_rate+ '%'});
                        $('#progress2').css('width',$data.ratio_date.week_ratio.order_rate + '%');
                    }
                }
                else
                {
                    //$('#tipText2').css({"color": 'red' });
                    $('#tipText2').append("&nbsp;<span class=\"layui-edge layui-edge-bottom\" lay-tips=\"同比下降\" ></span>"+')');
                    $('#progress2').css('background-color','indianred');
                    if(-$data.ratio_date.week_ratio.order_rate >= 100){
                        //$('#tipText2').css({'left': '90%'});
                        $('#progress2').css('width', '100%');
                    }
                    else{
                        $('#progress2').css('width',-$data.ratio_date.week_ratio.order_rate + '%');
                        //$('#tipText2').css({'left': -$data.ratio_date.week_ratio.order_rate + '%'});
                    }
                }



                //订单图表
                var order_total = $data.order_eachday;
                ncovChart(order_total);
                function ncovChart(chart_data){

                    //订单echarts初始化
                    var ncovCharts = echarts.init(document.getElementById('main'));

                    var ncov_options = {

                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'shadow',
                                label: {
                                    show: true
                                }
                            }
                        },
                        toolbox: {
                            show: true,
                            feature: {
                                mark: {show: true},
                                dataView: {show: true, readOnly: false},
                                magicType: {show: true, type: ['line', 'bar']},
                                restore: {show: true},
                                saveAsImage: {show: true}
                            }
                        },
                        calculable: true,
                        legend: {
                            data: ['订单数', '订单金额'],
                            itemGap: 8
                        },

                        xAxis: [
                            {
                                type: 'category',
                                data: chart_data.days
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value'

                            },
                        ],

                        series: [
                            {
                                name: '订单金额',
                                type: 'bar',
                                data: chart_data.money,
                                markLine: {
                                    data: [
                                        {type: 'average', name: '平均值'}
                                    ]
                                }
                            },
                            {
                                name: '订单数',
                                type: 'bar',
                                data: chart_data.order,
                                markLine: {
                                    data: [
                                        {type: 'average', name: '平均值'}
                                    ]
                                }
                            }
                        ],
                        dataZoom: [
                            {
                                show: true,
                                start: 0,
                                end: 100
                            },
                            {
                                type: 'inside',
                                start: 94,
                                end: 100
                            },

                        ],

                    };
                    ncovCharts.setOption(ncov_options);

                    //窗口监听================================================================

                    window.addEventListener("resize", function(){
                        ncovCharts.resize();
                    });

                }

                //用户数据图表
                var user_total = $data.user_eachday;
                userChart(user_total);
                function userChart(chart_data){

                    //订单echarts初始化
                    var userCharts = echarts.init(document.getElementById('user'));

                    var useroptions = {

                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'shadow',
                                label: {
                                    show: true
                                }
                            }
                        },
                        toolbox: {
                            show: true,
                            feature: {
                                mark: {show: true},
                                dataView: {show: true, readOnly: false},
                                magicType: {show: true, type: ['line', 'bar']},
                                restore: {show: true},
                                saveAsImage: {show: true}
                            }
                        },
                        calculable: true,
                        legend: {
                            data: ['用户注册数']
                        },

                        xAxis: [
                            {
                                type: 'category',
                                data: chart_data.days
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value',

                            },
                        ],

                        series: [
                            {
                                name: '用户注册数',
                                type: 'bar',
                                data: chart_data.user,
                                markLine: {
                                    data: [
                                        {type: 'average', name: '平均值'}
                                    ]
                                }
                            }
                        ],
                        dataZoom: [
                            {
                                show: true,
                                start: 0,
                                end: 100
                            },
                            {
                                type: 'inside',
                                start: 94,
                                end: 100
                            },
                            {
                                show: true,
                                yAxisIndex: 0,
                                filterMode: 'empty',
                                width: 30,
                                height: '80%',
                                showDataShadow: false,
                                left: '95%'
                            }
                        ],

                    };
                    userCharts.setOption(useroptions);

                    //窗口监听
                    window.addEventListener("resize", function(){
                        userCharts.resize();
                    });


                }

                // 订单图表按钮点击事件
                $('#order_week').click(function () {
                    //订单图表
                    var order_total = $data.order_eachday;
                    ncovChart(order_total);
                    //card对比
                    var ratio_date = $data.ratio_date.week_ratio;
                    $("#last_sales").text(ratio_date.last_sales);
                    $("#recent_sales").text(ratio_date.recent_sales);
                    $("#last_orders").text(ratio_date.last_orders);
                    $("#recent_orders").text(ratio_date.recent_orders);
                    $("#last_sales_text").text("上周销售额");
                    $("#recent_sales_text").text("本周销售额");
                    $("#last_orders_text").text("上周订单数");
                    $("#recent_orders_text").text("本周订单数");

                    var number = ratio_date.sale_rate;
                    var div1 = $("#tipText");
                    var div2 = $('#progress1');
                    progress(div1,div2,number);
                    var div3 = $("#tipText2");
                    var div4 = $('#progress2');
                    var number1 = ratio_date.order_rate;
                    progress(div3,div4,number1);
                    function progress(div1,div2,number){

                        div1.text('（本周与上周同比：'+number + '%');
                        if (number>0) {

                            div1.append("&nbsp;<span class=\"layui-edge layui-edge-top\" lay-tips=\"同比增长\" ></span>"+')');
                            //div1.css({"color": 'green'});
                            div2.css('background-color', 'green');
                            if (number >= 100) {
                                //div1.css({'left': '90%'});
                                div2.css('width','100%');
                            }
                            else {
                                //div1.css({'left': number + '%'});
                                div2.css('width', number + '%');

                            }
                        }
                        else
                        {
                            div1.append("&nbsp;<span class=\"layui-edge layui-edge-bottom\" lay-tips=\"同比下降\" ></span>"+')');
                            div2.css('background-color','indianred');
                            if(-number >= 100){
                                //div1.css({'left': '90%'});
                                div2.css('width','100%');
                            }
                            //div1.css({'left': -number + '%'});
                            div2.css('width',-number + '%');
                        }
                    }



                });
                $('#order_month').click(function () {
                    var order_total = $data.order_eachmonth;
                    ncovChart(order_total);
                    var ratio_month = $data.ratio_date.month_ratio;
                    $("#last_sales").text(ratio_month.last_sales);
                    $("#recent_sales").text(ratio_month.recent_sales);
                    $("#last_orders").text(ratio_month.last_orders);
                    $("#recent_orders").text(ratio_month.recent_orders);
                    $("#last_sales_text").text("上月销售额");
                    $("#recent_sales_text").text("本月销售额");
                    $("#last_orders_text").text("上月订单数");
                    $("#recent_orders_text").text("本月订单数");

                    var number = ratio_month.sale_rate;
                    var div1 = $("#tipText");
                    var div2 = $('#progress1');
                    progress(div1,div2,number);
                    var div3 = $("#tipText2");
                    var div4 = $('#progress2');
                    var number1 = ratio_month.order_rate;
                    progress(div3,div4,number1);
                    function progress(div1,div2,number){

                        div1.text('（本月与上月同比：'+number + '%');
                        if (number>0) {

                            div1.append("&nbsp;<span class=\"layui-edge layui-edge-top\" lay-tips=\"同比增长\" ></span>"+')');
                            div2.css('background-color', 'green');
                            if (number >= 100) {
                                //div1.css({'left': '90%'});
                                div2.css('width','100%');
                            }
                            else {
                                //div1.css({'left': number + '%'});
                                div2.css('width', number + '%');

                            }
                        }
                        else
                        {
                            div1.append("&nbsp;<span class=\"layui-edge layui-edge-bottom\" lay-tips=\"同比下降\" ></span>"+')');
                            div2.css('background-color','indianred');
                            if(-number >= 100){
                                //div1.css({'left': '90%'});
                                div2.css('width','100%');
                            }
                            //div1.css({'left': -number + '%'});
                            div2.css('width',-number + '%');
                        }
                    }

                });
                $('#order_year').click(function () {
                    var order_total = $data.order_eachyear;
                    ncovChart(order_total);
                    var ratio_year = $data.ratio_date.year_ratio;
                    $("#last_sales").text(ratio_year.last_sales);
                    $("#recent_sales").text(ratio_year.recent_sales);
                    $("#last_orders").text(ratio_year.last_orders);
                    $("#recent_orders").text(ratio_year.recent_orders);
                    $("#last_sales_text").text("去年销售额");
                    $("#recent_sales_text").text("今年销售额");
                    $("#last_orders_text").text("去年订单数");
                    $("#recent_orders_text").text("今年订单数");

                    var number = ratio_year.sale_rate;
                    var div1 = $("#tipText");
                    var div2 = $('#progress1');
                    progress(div1,div2,number);
                    var div3 = $("#tipText2");
                    var div4 = $('#progress2');
                    var number1 = ratio_year.order_rate;
                    progress(div3,div4,number1);
                    function progress(div1,div2,number){

                        div1.text('（今年与去年同比：'+number + '%');
                        if (number>0) {

                            div1.append("&nbsp;<span class=\"layui-edge layui-edge-top\" lay-tips=\"同比增长\" ></span>"+')');
                            div2.css('background-color', 'green');
                            if (number >= 100) {
                                //div1.css({'left': '90%'});
                                div2.css('width','100%');
                            }
                            else {
                                //div1.css({'left': number + '%'});
                                div2.css('width', number + '%');

                            }
                        }
                        else
                        {
                            div1.append("&nbsp;<span class=\"layui-edge layui-edge-bottom\" lay-tips=\"同比下降\" ></span>"+')');
                            div2.css('background-color','indianred');
                            if(-number >= 100){
                                // div1.css({'left': '90%'});
                                div2.css('width','100%');
                            }
                            //div1.css({'left': -number + '%'});
                            div2.css('width',-number + '%');
                        }
                    }
                });

                // 用户图表按钮点击事件
                $('#user_week').click(function () {
                    var user_total = $data.user_eachday;
                    userChart(user_total);
                });
                $('#user_month').click(function () {
                    var user_total = $data.user_eachmonth;
                    userChart(user_total);
                });
                $('#user_year').click(function () {
                    var user_total = $data.user_eachyear;
                    userChart(user_total);
                });





            }
        }, 'post');

    })


</script>